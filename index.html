<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- jQuery library -->
    <script src="./jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="./bootstrap.min.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" type="text/css" href="./bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="./style.css">
    <title>DuesApp</title>
</head>
<body onresize="update_graph()">
    <script>
        var language; 
        function getLanguage() {
            (localStorage.getItem('language') == null) ? setLanguage('es') : false;
            $.ajax({ 
                url:  './language/' +  localStorage.getItem('language') + '.json', 
                dataType: 'json', async: false, dataType: 'json', 
                success: function (lang) { language = lang } 
            });
        }
        
        function setLanguage(lang) {
            localStorage.setItem('language', lang);
        }
        setLanguage('es');
        getLanguage();
        // Load text from selected language
        $(document).ready(function(){
            $('#menu h4')[0].innerText = language.menu;

            // Menu buttons
            $('#button-addnode')[0].innerText = language.menu_addnode;
            $('#button-editnode')[0].innerText = language.menu_editnode;
            $('#button-rennode')[0].innerText = language.menu_rennode;
            $('#button-delnode')[0].innerText = language.menu_delnode;
            $('#button-update')[0].innerText = language.menu_update;
            $('#button-clear')[0].innerText = language.menu_clear;
            $('#button-addrel')[0].innerText = language.menu_addrel;
            $('#button-delrel')[0].innerText = language.menu_delrel;
            $('#button-reset')[0].innerText = language.menu_reset;
            
            // Modals
            $("#menu-addnode h4")[0].innerText = language.menu_addnode;
            $("#menu-addnode label")[0].innerText = language.menu_addnode_name;
            $("#menu-addnode label")[1].innerText = language.menu_addnode_wallet;
            $("#menu-delnode h4")[0].innerText = language.menu_delnode;
            $("#menu-delnode label")[0].innerText = language.menu_delnode_node;
            $("#menu-addrel h4")[0].innerText = language.menu_addrel;
            $("#menu-addrel label")[0].innerText = language.menu_rel_to;
            $("#menu-addrel label")[1].innerText = language.menu_rel_from;
            $("#menu-addrel label")[2].innerText = language.menu_rel_value;
            $("#menu-delrel h4")[0].innerText = language.menu_delrel;
            $("#menu-delrel label")[0].innerText = language.menu_rel_to;
            $("#menu-delrel label")[1].innerText = language.menu_rel_from;
            

            // Modal footer
            var okButtons = $(".modal-footer .btn-success")
            for(button in okButtons){
                okButtons[button].innerText = language.menu_ok;
            }
            var cancelButtons = $(".modal-footer .btn-danger")
            for(button in cancelButtons){
                cancelButtons[button].innerText = language.menu_cancel;
            }
            
        });
    </script>

    <div style="position: absolute;z-index: 1;">
        <button type="button" class="btn btn-default btn-lg" data-toggle="modal" data-target="#menu">
            <span class="glyphicon glyphicon-menu-hamburger" aria-hidden="true"></span>
        </button>
    </div>
    
        
    <canvas id="graph"></canvas>
    
    <!-- Modal Menu -->
    <div id="menu" class="modal fade" role="dialog">
        <div class="modal-dialog">
        
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Tools</h4>
                </div>
                <div class="modal-body">
                    <button id="button-addnode" class="btn btn-primary btn-block" onclick="modalTransition('menu','menu-addnode')">Add Node</button>
                    <button id="button-editnode" class="btn btn-primary btn-block disabled" onclick="modalTransition('menu','menu-editnode')">Edit Node</button>
                    <button id="button-rennode" class="btn btn-primary btn-block disabled" onclick="modalTransition('menu','menu-rennode')">Rename Node</button>
                    <button id="button-delnode" class="btn btn-danger btn-block" onclick="modalTransition('menu','menu-delnode')">Delete Node</button>
                    <br />
                    <button id="button-update" class="btn btn-warning btn-block" onclick="update_onclick()" data-dismiss="modal"> Update Graph</button>
                    <button id="button-clear" class="btn btn-warning btn-block" onclick="clear_onclick()" data-dismiss="modal"> Clear Graph</button>
                    <br />
                    <button id="button-addrel" class="btn btn-primary btn-block" onclick="modalTransition('menu','menu-addrel')">Add Relation</button>
                    <button id="button-delrel" class="btn btn-danger btn-block" onclick="modalTransition('menu','menu-delrel')">Delete Relation</button>
                    <button id="button-reset" class="btn btn-danger btn-block" onclick="resRel_onclick()" data-dismiss="modal">Reset Relations</button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>
            </div>
            
        </div>
    </div>

    <!-- Modal addnode -->
    <div id="menu-addnode" class="modal fade" role="dialog">
        <div class="modal-dialog">
        
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Add Node</h4>
                </div>
                <div class="modal-body">
                    <center>
                        <label>Name:   </label>
                        <input id=node_text>
                        <br />
                        <label>Wallet: </label>
                        <input id=wallet_text>
                    </center>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" onclick="addNode_onclick()">Ok</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>
            </div>
            
        </div>
    </div>

    <!-- Modal delnode -->
    <div id="menu-delnode" class="modal fade" role="dialog">
        <div class="modal-dialog">
        
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Delete Node</h4>
                </div>
                <div class="modal-body">
                    <center>
                        <label>Node: </label>
                        <select id="delselec"></select>
                    </center>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" onclick="deleteNode_onclick()" data-dismiss="modal">Ok</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>
            </div>
            
        </div>
    </div>

    <!-- Modal addrel -->
    <div id="menu-addrel" class="modal fade" role="dialog">
        <div class="modal-dialog">
        
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Add Relation</h4>
                </div>
                <div class="modal-body">
                    <center>
                        <label>From: </label>
                        <select id="addrelselec1"></select>
                        <br />
                        <label>To: </label>
                        <select id="addrelselec2"></select>
                        <br />
                        <label>Value: </label>
                        <input id=textValue>
                    </center>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" onclick="addRel_onclick()">Ok</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>
            </div>
            
        </div>
    </div>

    <!-- Modal delrel -->
    <div id="menu-delrel" class="modal fade" role="dialog">
        <div class="modal-dialog">
        
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Delete Relation</h4>
                </div>
                <div class="modal-body">
                    <center>
                        <label>From: </label>
                        <select id="delarcselec1"></select>
                        <br />
                        <label>To: </label>
                        <select id="delarcselec2"></select>
                    </center>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" onclick="delRel_onclick()" data-dismiss="modal">Ok</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>
            </div>
            
        </div>
    </div>

    <script>
        $("#graph")[0].width = $(window)[0].innerWidth;
        $("#graph")[0].height = $(window)[0].innerHeight;
        var imageNode;
        var imageArrow;
        window.onload = function() {
            imageNode = new Image();
            imageNode.src = "./images/node.PNG";
            imageArrow = new Image();
            imageArrow.src = "./images/arrow.PNG";
        };

        function modalTransition(id1, id2){
            $("#"+id1).modal("hide");
            $("#"+id2).modal("show");
        }

        // Node text functions
        function get_textnode(){
            return document.getElementById('node_text').value;
        }
        function set_textnode(input){
            document.getElementById('node_text').value = input;
        }
        function clear_textnode(){
            set_textnode("");
        }

        // Wallet text functions
        function get_textwallet(){
            if(document.getElementById('wallet_text').value == ""){
                return "0";
            }
            return document.getElementById('wallet_text').value;
        }
        function set_textwallet(input){
            document.getElementById('wallet_text').value = input;
        }
        function clear_textwallet(){
            set_textwallet("");
        }
        
        // Value text functions
        function get_textvalue(){
            if(document.getElementById('textValue').value == ""){
                return "0";
            }
            return document.getElementById('textValue').value;
        }
        function set_textvalue(input){
            document.getElementById('textValue').value = input;
        }
        function clear_textvalue(){
            set_textvalue("");
        }
        
        // UI functions
        function addNode_onclick(){
            var text=get_textnode();
            var wallet = get_textwallet();
            var node = new Node(text, wallet)
            nodes.add(node);
            clear_textnode();
            clear_textwallet();
            update_graph();
        }
        function deleteNode_onclick(){
            var text = document.getElementById('delselec').value;
            nodes.delete(text);
            update_graph();
        }
        function update_onclick(){
            update_graph();
        }
        function clear_onclick(){
            nodes.delete_all();
            update_graph();
        }
        function addRel_onclick(){
            var nameA = document.getElementById('addrelselec1').value;
            var nameB = document.getElementById('addrelselec2').value;
            var nodeA = nodes.get(nameA);
            var nodeB = nodes.get(nameB);
            var arc = new Arc(nodeA, nodeB, get_textvalue());
            arcs.add(arc);
            clear_textvalue();
            update_graph();
        }
        function delRel_onclick(){
            var nameA = document.getElementById('delarcselec1').value;
            var nameB = document.getElementById('delarcselec2').value;
            var key = gen_arc_key(nameA, nameB);
            arcs.delete(key);
            clear_textvalue();
            update_graph();
        }
        function resRel_onclick(){
            arcs.delete_all();
            clear_textvalue();
            update_graph();
        }
    </script>
    <script src = "graph.js"></script>
</body>
</html>